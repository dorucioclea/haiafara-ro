language: ruby
addons:
  postgresql: 9.6
  apt:
    packages:
    - postgresql-9.6-postgis-2.3
cache:
  bundler: true
  yarn: true
  directories:
  - node_modules
install:
- bundle install
- nvm install node
- npm i -g yarn
- yarn
script:
- bundle exec rails db:setup
- bundle exec rails webpacker:compile
- bundle exec rails test
before_deploy:
- openssl aes-256-cbc -K $encrypted_545545218908_key -iv $encrypted_545545218908_iv
  -in deploy_rsa.enc -out deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy\_rsa
- ssh-add /tmp/deploy\_rsa
- echo -e
  "Host $DEPLOY_HOST\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
deploy:
  provider: script
  script: bundle exec mina deploy
  on:
    branch: master
env:
  global:
  - secure: c1BXzrRstTgIqRFn66b5Nj6saVFpAXU2njkVu9+OBaGKqBEgLBMDsCyEQ+rAaiug51iOPxbSeudnfcYZ0Z2NVOfojDVAfdtz2tgvaFTI9p66Ua4BS77MHcwT4rQPuaSftYFQ0e6oHTbVUxMVOP5/FYnQLoWbb6gcbJKa+FK2J1xzJadYAYmjP/6CF6qnztIMcQX9tj0y+MImmRyIgyg88ZUbuaasgt0GRV35Ex3ARkKtDvUmepUDxIWVNZILnPPpC2hoq3ej0Zo0RI+nRXqP11ydw9VfFl5T9uSjwQYAlLkYTnoMfDORFX91LUTzQzCaB2AgQAyS5du2jto7WT2epEhhgwxQTCBMLCqK4NQBrsNxPP7fzPMJmQZrUrleBizno/C6YNvcY4rKafMWJ7NtRiDB9Ml7M1qqpTEZJf7HlV/2JSuqxsqmc/ksAuLeVQNbo+si4cM5cl1dmFIH0JLkXejVQJr14kB7WZJW3LnqS0I9FT5ZgmIK1WFEM599lOK7T3D8Bhr6nWW9+7JBq9KvPBwlavR4GktqsiABdctSPQT24dzFJVX+Bf+DMr/oXDaAldUMPwcNqOOKua+D1ayvdkinm7J0YRCtqulpSIFUnyMPdNj/dL9hAwZbx4gg/R1p9fBN9oiT2QKsgRkK7RIuS0JEEMvlnzwXjN+ZViOmj3Q=
  - secure: qFMZ3g1d8U4FKXhIOAYN17ntK139veaEFhz6BDXfXO9tm5gfq7WbhA7kRmn2tojGmnqdUJJuZL3tSj/Rr/Z8/VsrmsQgTH2DvF01eStciEy1xUKFVZGtq0lIKEoHzY23myFspB9FqluOjZi7FJ76pSGWMxGTnX6OiRR0FyMRrlUFNwjuA11aqyoTq2ThtwPljVFnzH/+5MWwq0uRDAp9Ie00Y1z9VRy5585S+LsBEPPcUhcBw/Y6PGQPfJsbpXO9G1F/8hKHiifP8Q7MV4LCJyjjQgxGOTheMQyBMhL+yYsVFesOZGGqH4zhfvGJ1Gazpbl6b2eNvqPwBoCLsEB4iFKlV/eplKoKhld5CJZCeRtDRvlbFpRL7E7CgB6gqC8KTqhJ4YIqQrDl6QH7/pU3bQlCFpoz9P5ACFQ6tbKlef7gVqWU2Ci0J7vXE0m3YYBHON4InQSmfhc0nX7G9JoNxGADPSntGBV3ViVRRT4Ictf70VDiIb6HufmcFsiyPcKBxWHP5fXZcUmEUvvfU6cb+sHX51PhiXEgODkQOsAev2M7koZuWDx5EBPrwBcr6rs5MxFHRtS9qyp/6U019URCpBLSOL6miNHV6MQF36sKNGbaHdOKx8Im7dRX/PPNxwz3x/axqDRlxCVTxyGxW6P17/+uy1qbEy+Mxy/IGBDCmyQ=
  - secure: jgLHrJgGBBzq83Qlhju7Gd01wClDT/xMCHO2jl36RR0MGwQNWUl+lQN9OXSBH4zLgW6T1LLK7nxfVMhbroe7DUQiAN3OCBSASxSzKBU3DK8GfLpUJkqRp3oJxI6ozU6rYi2XLc/b4hM8opBocAo1Dn+jvbGl7MtNrb6tskMBUIAYeDj61GyOLM0z5w5MZTVmrVZCOQgdTZPdWbvjhS4IFgCN/wzp7Rrb4ZV5Kbr1nzr3pAgQkYnDajkaO+CzsH6W4rwtJZY5/ivnu16csJkqULhXp09oSo1o14wFbKuP3ZdwfjCli1xU+cMA+78EtODObnEce/dkQEpR+MCId7gYHuseuwKeLKcYxlRgtUUrvMv7jUoztiPijTAxn5UHSJ45mSvbdQiY93jIkL8SoTC4G48ug1UagDTzvW0Q4cMquuQKI3aC8nh3imGiGlh08DHJD+ChzhxGeJ13TgGCornVvN3Qae7oPpvqU27i+HoFkbNxPa8GM2QM0gDlci6lJ0spY9ZMFYXkE54b93tlNMgTJPWgtSl8jmp8c7Ks5cxYiGAiSvjfFsjGwhNlMq2j4seswQ9t5iD/OzE9vN3xloPxHFSuZV8M6CjxtPqSOn4wDYibFGSsr75PwWeeD6P+7B+j1sR/FMJYgHdBGIbaArtVf1t84xBzbOMKIk1NZL4fIrI=
